<!DOCTYPE html>
<meta charset="utf-8">
    <title>Place Autocomplete Address Form</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>

.districts :hover {
  fill: red;
}

.district-borders {
  fill: none;
  stroke: #fff;
  stroke-width: 0.5px;
  stroke-linejoin: round;
  stroke-linecap: round;
  pointer-events: none;
}

    </style>

    <script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="https://d3js.org/topojson.v2.min.js"></script>
	<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script> -->
    <body>

   <!-- TODO restore google autocomplete and style -->
  <!-- address input fields, TODO add google autocomplete example -->
     <table id="address">
      <tr>
        <td class="label">Street address</td>
        <td class="slimField"><input class="field" id="street_number"></input></td>
       <!-- <td class="wideField" colspan="2"><input class="field" id="route"></input></td> -->
      </tr>
      <tr>
        <td class="label">City</td>
        <!-- Note: Selection of address components in this example is typical.
             You may need to adjust it for the locations relevant to your app. See
             https://developers.google.com/maps/documentation/javascript/examples/places-autocomplete-addressform
        -->
        <td class="wideField" colspan="3"><input class="field" id="locality"></input></td>
      </tr>
      <tr>
        <td class="label">State</td>
        <td class="slimField"><input class="field" id="administrative_area_level_1"></input></td>
        <td class="label">Zip code</td>
        <td class="wideField"><input class="field" id="postal_code"></input></td>
      </tr>
    </table>
    <button onClick=getDistricts()>Get Districts</button>

  <div id="maps">
  	<div id="district-map" width="400" height="600">

	</div>

  </div>


  <script>

	function getDistricts(){



		var baseUrl = "https://geocoding.geo.census.gov/geocoder/geographies/address";
		var benchmark = "Public_AR_Current";
		var vintage = "Current_Current";
		var layers = "54,56,58";

		var street = document.getElementById('street_number').value;
		var city = document.getElementById('locality').value;
		var state = document.getElementById('administrative_area_level_1').value;
		var zip = document.getElementById('postal_code').value;

		var query = baseUrl + "?street=" + encodeURIComponent(street) + "&city=" + encodeURIComponent(city) + "&state=" + encodeURIComponent(state) + "&zip=" + zip + "&benchmark=" + benchmark + "&vintage=" + vintage + "&layers=" + encodeURIComponent(layers) + "&format=json";
	
		/*TEST
		var street = '1661 15th St';
		var city = 'San Francisco';
		var state = 'California';
		var zip = '94103';

		var query =  "https://geocoding.geo.census.gov/geocoder/geographies/address?street=1661%2015th%20St&city=San%20Francisco&state=California&zip=94103&benchmark=Public_AR_Current&vintage=Current_Current&layers=54%2C56%2C58&format=jsonp" ;
		//generates sample_output_census.json
		*/

		console.log(query);
	
		/*
		//if using ajax instead of d3.json 
		$.ajax({
  			url: baseURl,
  			data: {
    			street: street,
    			city: city,
    			state: state,
    			zip: zip,
    			benchmark: benchmark,
    			vintage: vintage,
    			layers: layers,
    			format: 'jsonp'
  			},
  			success: function( result ) {
    			console.log(result)
    			//TODO update map
  			}
		});
		*/

	}

	//TODO render simple maps

var svg = d3.select("#district-map").append("svg:svg");

var path = d3.geoPath();


d3.json("/data/ca-cd115-albers-id-topo-sq.json", function(error, us) {
  if (error) throw error;

  svg.append("g")
      .attr("class", "districts")
    .selectAll("path")
    .data(topojson.feature(topology, topology.objects.cd115).features)
    .enter().append("path")
      .attr("d", path);

  svg.append("path")
      .attr("class", "district-borders")
      .attr("d", path(topojson.mesh(topology, topology.objects.cd115, function(a, b) { return a !== b; })));
});



	/*
	//map testing for fixed address
	d3.json("/data/sample_output_census.json", function(data) {
  		console.log(data);
	});
 	*/

  </script>




  </body>